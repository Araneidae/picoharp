# Template of period specific picoharp data
#
#% macro, DEVICE, Device name
#% macro, PORT, Asyn port
#% macro, SUFFIX, Suffix for name
#% macro, EVENT, Event number used for update signalling

record(waveform, "$(DEVICE):SAMPLES_$(SUFFIX)") {
  field(DTYP, "asynFloat64ArrayIn")
  field(INP,  "@asyn($(PORT))samples_$(ASUFFIX)")
  field(FTVL, "DOUBLE")
  field(NELM, "65536")
  field(DESC, "Raw picoharp signal")
  field(SCAN, "Event")
  field(EVNT, "$(EVENT)")
}

record(waveform, "$(DEVICE):RAW_BUCKETS_$(SUFFIX)") {
  field(DTYP, "asynFloat64ArrayIn")
  field(INP,  "@asyn($(PORT))raw_buckets_$(ASUFFIX)")
  field(FTVL, "DOUBLE")
  field(NELM, "936")
  field(DESC, "Uncorrected fill pattern")
  field(SCAN, "Event")
  field(EVNT, "$(EVENT)")
}

record(waveform, "$(DEVICE):FIXUP_$(SUFFIX)") {
  field(DTYP, "asynFloat64ArrayIn")
  field(INP,  "@asyn($(PORT))fixup_$(ASUFFIX)")
  field(FTVL, "DOUBLE")
  field(NELM, "936")
  field(DESC, "Fill pattern correction factor")
  field(SCAN, "Event")
  field(EVNT, "$(EVENT)")
}

record(ai, "$(DEVICE):MAX_FIXUP_$(SUFFIX)") {
  field(DTYP, "asynFloat64")
  field(INP,  "@asyn($(PORT))max_fixup_$(ASUFFIX)")
  field(DESC, "Maximum correction factor")
  field(PREC, "2")
  field(SCAN, "Event")
  field(EVNT, "$(EVENT)")
}

record(waveform, "$(DEVICE):BUCKETS_$(SUFFIX)") {
  field(DTYP, "asynFloat64ArrayIn")
  field(INP,  "@asyn($(PORT))buckets_$(ASUFFIX)")
  field(FTVL, "DOUBLE")
  field(NELM, "936")
  field(DESC, "Corrected fill pattern")
  field(SCAN, "Event")
  field(EVNT, "$(EVENT)")
}

record(ai, "$(DEVICE):SOCS_$(SUFFIX)") {
  field(DTYP, "asynFloat64")
  field(INP,  "@asyn($(PORT))socs_$(ASUFFIX)")
  field(EGU,  "nC^2")
  field(PREC, "0")
  field(DESC, "Total counts squared")
  field(SCAN, "Event")
  field(EVNT, "$(EVENT)")
  field(HSV,  "MINOR")
  field(HIGH, "490")
  field(HHSV, "MAJOR")
  field(HIHI, "500")
}

record(ai, "$(DEVICE):TURNS_$(SUFFIX)") {
  field(DTYP, "asynFloat64")
  field(INP,  "@asyn($(PORT))turns_$(ASUFFIX)")
  field(EGU,  "turns")
  field(PREC, "0")
  field(DESC, "Number of turns captured")
  field(SCAN, "Event")
  field(EVNT, "$(EVENT)")
}

record(waveform, "$(DEVICE):PROFILE_$(SUFFIX)") {
  field(DTYP, "asynFloat64ArrayIn")
  field(INP,  "@asyn($(PORT))profile_$(ASUFFIX)")
  field(FTVL, "DOUBLE")
  field(NELM, "62")
  field(DESC, "Bucket profile")
  field(SCAN, "Event")
  field(EVNT, "$(EVENT)")
}

record(ai, "$(DEVICE):PEAK_$(SUFFIX)") {
  field(DTYP, "asynFloat64")
  field(INP,  "@asyn($(PORT))peak_$(ASUFFIX)")
  field(SCAN, "Event")
  field(EVNT, "$(EVENT)")
  field(EGU,  "bins")
  field(PREC, "0")
  field(LOPR, "1")
  field(HOPR, "63")
  field(LOLO, "6")
  field(LOW,  "12")
  field(HIGH, "50")
  field(HIHI, "57")
  field(LLSV, "MAJOR")
  field(LSV,  "MINOR")
  field(HSV,  "MINOR")
  field(HHSV, "MAJOR")
  field(DESC, "Offset of first peak")
}

record(ai, "$(DEVICE):FLUX_$(SUFFIX)") {
  field(DTYP, "asynFloat64")
  field(INP,  "@asyn($(PORT))flux_$(ASUFFIX)")
  field(EGU,  "count/turn")
  field(PREC, "3")
  field(DESC, "Counts observed per turn")
  field(SCAN, "Event")
  field(EVNT, "$(EVENT)")
}

record(ai, "$(DEVICE):NFLUX_$(SUFFIX)") {
  field(DTYP, "asynFloat64")
  field(INP,  "@asyn($(PORT))nflux_$(ASUFFIX)")
  field(EGU,  "count/turn/nC")
  field(PREC, "1")
  field(DESC, "Normalised counts observed per turn")
  field(SCAN, "Event")
  field(EVNT, "$(EVENT)")
}

record(ai, "$(DEVICE):TOTAL_COUNT_$(SUFFIX)") {
  field(DTYP, "asynFloat64")
  field(INP,  "@asyn($(PORT))total_count_$(ASUFFIX)")
  field(EGU,  "count")
  field(PREC, "0")
  field(DESC, "Total number of counts observed")
  field(SCAN, "Event")
  field(EVNT, "$(EVENT)")
}
